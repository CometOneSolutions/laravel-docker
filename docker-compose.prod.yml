version: '3.8'

services:
  site:
    build:
      context: .
      dockerfile: nginx.prod.dockerfile
    ports:
      - 443:443
    # depends_on:
    #   - assets
    # command: "/bin/sh -c 'while :; do sleep 6h & wait $${!}; nginx -s reload; done & nginx -g \"daemon off;\"'"

  php:
    build:
      context: .
      dockerfile: php.prod.dockerfile
      args:
        - UID=${UID:-1000}
        - GID=${GID:-1000}

  # assets:
  #   image: node:current-alpine
  #   volumes:
  #     - ./src:/var/www/html
  #     - ./certbot/conf:/etc/letsencrypt
  #     - ./certbot/www:/var/www/certbot
  #   command: ["/bin/sh", "-c", "npm install && npm run production"]
  #   working_dir: /var/www/html

  # certbot:
  #   image: certbot/certbot
  #   entrypoint: "/bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 12h & wait $${!}; done;'"
  #   volumes:
  #     - ./certbot/conf:/etc/letsencrypt
  #     - ./certbot/www:/var/www/certbot
